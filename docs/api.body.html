</ul>

<article>
<h2><a name="notes">Notes about this document:</a></h2>

<section>
<h3>Implementation Indicators</h3>
<div>
    <ul>
    <li>"WIP" = "Work in Progress; first attempt to get something that works at all, change is likely, removal is possible"
    <li>"Draft" = "It seems to work, waiting for the whole team + consultants to say Yay, change is possible"
    <li>"Untested" = "automated tests are incomplete"
    <li>Just a number = "Ready to be used -- team + consultants like the design and it is tested"
    </ul>
</div>
</section>

<section>
<h3>Terminology Note</h3>
<div>
    <p>The API is abstracted from the presentation of the Civicboom website.
       There may be some discrepancies e.g. 'groups' in the API are referred to as 'Hubs' on the website.
       The API terminology is fixed. The website front-end terminology is subject to change.</p>
</div>
</section>

<section>
<h3>Contacts</h3>
<div>
	For technical questions and comments, email <a href="mailto:developers@civicboom.com">developers@civicboom.com</a>
</div>
</section>

</article>


<article>
<h2><a name="common">Things common to all requests:</a></h2>

<section>
<h3>Servers</h3>
<div>
    <p><a href="http://api-v1.civicboom.com/">http://api-v1.civicboom.com/</a> - Clients
	should use this rather than www.civicboom.com - www
	will always be running the latest code and may sometimes break compatability in major
	ways. If a major break is necessary, we will try and keep older versions of the API
	available on the API domains long enough for people to transition to the new one.
	<p>The API servers allow HTTP as well as HTTPS; it is presumed that anyone writing an
	API client will know the costs and benefits of an unencrypted connection and can make
	and informed decision for themselves.

    <p><a href="https://test.civicboom.com">https://test.civicboom.com</a> - 
    Developers are encouraged to test the use of the API on the dedicated test server.
    The data on the test server will be periodically reset.
    <p>The test server is not a guaranteed service and may have periods of unavailability.
</div>
</section>

<section>
<h3><span>(1.0 WIP)</span>Transport</h3>
<div>
    <ul>
    <li>All content-modifying actions (POST, PUT, DELETE) require an _authentication_token
        argument; since this is universal, it isn't mentioned in the docs for each action
        separately. The token can be found by calling /account/signin.json or /account/signin.xml
    <li>Cookies are used to keep track of logged in sessions.
        Your client may be sent additional cookies while using the API.
        These should be stored and retrieved as normal cookies.
    <li>PUT and DELETE can be emulated with POST, having the form variable "_method" set
        to PUT or DELETE respectively
    <li>HTTP status codes are used:
        <ul>
          <li>200 - generic success
          <li>201 - content created
          <li>400 - generic user error (commonly missing required data when submitting a form)
          <li>403 - permission denied
          <li>404 - content/member not found
          <li>500 - generic server error
          <li>501 - not implemented
          <li>502 - back-end server is down for maintenance
        </ul>
    </ul>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span><a name="objects">Object types overview</a></h3>
<style>
#model TABLE {
	width: 100%;
}
#model DIV {
	border: 2px solid #abbccd;
	margin: 16px;
	padding: 0px 16px 16px 16px;

	-moz-box-shadow: 6px 6px 4px #888;
	-webkit-box-shadow: 6px 6px 4px #888;
	box-shadow: 6px 6px 4px #888;

	-moz-border-radius: 32px;
	border-radius: 32px;
}
#model>DIV {
	margin: auto;
	margin-bottom: 16px;
	max-width: 1000px;
}
#model TD {
	vertical-align: top;
}
#model H4 {
	background: none;
	border: none;
	text-align: center;
	margin-top: 8px;
}
</style>
<div id="model">

<div style="background: #fdd">
<h4>Content</h4>
Content is the main point of Civicboom - each bit of Content can have a title,
text, attachments, location, a creator, the date it was created, if it is a
reply to something else, a redistribution license, etc etc.
<table><tr>
	<td style="width: 50%;">
		<div style="background: #dbb">
		<h4>Draft</h4>
		Content that is being worked on privately. Notably, it has a target_type
		field which determines what type of Content it will become after the
		user hits "Publish"
		</div>
	</td>
	<td style="width: 50%;">
		<div style="background: #dbb">
		<h4>Comment</h4>
		A short comment attached to another bit of Content, normally used to
		request more details or clarify points in a request
		</div>
	</td>
</tr><tr>
	<td colspan="2">
		<div style="background: #dbb">
		<h4>Visible Content</h4>
		A bit of content designed to be viewed as a stand-alone unit. Will keep
		track of the number of times it gets viewed and boomed.
		<table><tr>
			<td style="width: 50%;">
				<div style="background: #b99">
				<h4>Article</h4>
				A stand-alone article; possibly in response to an Assignment
				(if parent_id is set). Can have a rating (e.g. 1-5 stars).
				If it is in response to an Assignment, the assigner can
				approve or reject it.
				</div>
			</td>
			<td style="width: 50%;">
				<div style="background: #b99">
				<h4>Assignment</h4>
				A question to be responded to; can have an event date (e.g.
				the date of a festival to report on) and a due date (e.g. a
				couple of days later, so the responders have time to write
				and organise media)
				</div>
			</td>
			<!--
			<td style="width: 33%;">
				<div style="background: #b99">
				<h4>Syndicated (Not implemented)</h4>
				An article that a user has written and wants a newspaper to
				pay for
				</div>
			</td>
			-->
		</tr></table>
		</div>
	</td>
</tr></table>
</div>

<div style="background: #dfd">
<h4>Member</h4>
Most actions in Civicboom can be applied to Users and Groups equally; e.g.
any Member can contribute to Content, any Member can be sent a Message, any
Member can be part of a Group (i.e., Groups can be nested)
<table><tr>
	<td style="width: 50%;">
		<div style="background: #bdb">
		<h4>User</h4>
		A User represents an individual person, somebody who signs in to the
		site. Even when somebody wants an account for their organisation,
		they still sign in as themselves before switching to control the
		Group persona.
	</td>
	<td style="width: 50%;">
		<div style="background: #bdb">
		<h4>Group</h4>
		A Group is a collection of Members (either Users or other Groups). A
		Group essentially acts and does things the same way that a User does,
		but it can be controlled by multiple people at once.
	</td>
</tr></table>
</div>

<div style="background: #ddf">
<h4>Message</h4>
A short bit of text; either from one Member to another (for private messaging),
or from nobody (for system notifications)
</div>

<div style="background: #fdf">
<h4>Media</h4>
An attachment to some Content
</div>

</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>Data formats</h3>
<div>
    <p>Formats can be added to the end of the URL; for instance while /contents/42
    will show you content #42 in a browser-friendly way (HTML), a standalone app
    may prefer /contents/42.json or /contents/42.xml
    
    <p>Most examples in this documentation will be given in JSON format.
    
    <p>Format list:
    <ul>
        <li>JSON
        <li>XML
        <li>Frag
        <li>RSS
        <li>Redirect
        <li>iCal
        <li>PDF
    </ul>
    
    <h4>JSON</h4>
	<p>Note that in all cases, JSON requests can have a "callback" parameter
	passed to them in order to wrap the data as JSONP. Valid callback names
	can have letters, numbers, and underscores in them.

    <p>JSON data format:
    <pre>
    {
        "status" : "ok" / "error" / "invalid",                 (required)
        "message": "string to show in app status bar / popup", (required; can be null if status=ok)
        "data"   : {                                           (required; blank dictionary if there is no data)
            "foo": "bar", # function-specific data
            "baz": "qux",
            ...
        }
    }
    </pre>
    
    <p>JSON list format:
    <pre>
    {
        "status" : "ok",
        "message": null,
        "data"   : {
            "list": {
                "items": [
                    {...},
                    {...},
                    {...}
                ],
                "type"  : "content" / "member" / "message",
                "offset":  0,
                "limit" : 20,
                "count" :  3
            }
        }
    }
    </pre>
    
    <h4>XML</h4>
    <p>The same as JSON, just in XML.</p>
    
    <h4>Frag</h4>
    <p>Fragments are chunks of HTML data with marked up with classes for use with
       injecting content directly into existing web pages. The developer can then
       style this injected HTML simply with standard CSS rules
    <p>WIP NOTE: Currently .frag returns HTML specific to the Civicboom site and is
       not generic enough for mainstream use. Work is currently underway to make the
       .frag a generic tool for developers. (tentatively May 2011)
    
    <h4>RSS</h4>
    <p>Objects and Lists can be returned as RSS feeds
    <p>Some of the fields are not relevant for an RSS output.
       The list is fields returned in the RSS often a subset of the JSON/XML output.
    <p><!--It is part of the RSS standard that clients can sort items by date.
       Some objects may return lists of items that are not in date order.-->
	   Note that entries are not necessarily in order, i.e. a member object will
	   be built of several smaller lists (e.g. top 3 requests + top 3 articles +
	   top 3 boomed).
    <p>Hint: Common use of RSS 'content' lists:
       By default media attachments are not included in the RSS return
       but can be enabled by including the parameter 'include_fields=attachments'</p>
    
    <h4>Redirect</h4>
    <p>Actions can be called with the 'redirect' format. This will perform the action on Civicboom
       and then redirect back to http_referer.
    <p>If the request has come from an external site the user will be prompted to confirm they want to perform the action.
       If they are not currently logged in they will be prompted to signin/signup
    <p>(NOTE: When undertaking the signup process it may not be possible to return to external sites via http_referer,
       this will be investigated)
       
    <h4>iCal</h4>
    <p>Pending implementation</p>
    
    <h4>PDF</h4>
    <p>Pending implementation</p>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>List Controls</h3>
<div>
    <p>API calls masked as 'list' will return lists of objects.
       These lists can be customised by passing common control parameters.
    <ul>
        <li>
            <p>list_type: default='default'
            <p>Permitted Values
            <ul>
            <li>'empty' = no fields (to be used with include_fields to build a custom object)
            <li>'default' = object fields (usually used for list as no links to other objects are present)
            <li>'full' = object + links (links to sub objects or lists are followed e.g. a contents creator field will contain a sub object member).
                 full field lists often include fields that are expensive to process and are normally unnecessary for summary lists.
            </ul>
        
        <li>
            <p>'exclude_fields': omit fields from the return object default=''
            <p>e.g. "exclude_fields=avatar_url,location_home" will omit the fields avatar_url and location_home form the returned list.
        
        <li>
            <p>'include_fields': fields to include in the return object default=''
            <p>e.g. 'include_fields=followers,username,name,webpage,content_public'.
            <p>e.g. 'include_fields=attachments'
            <p>Often used in conjunction with 'list_type=empty' to build a custom return object.
               Often used to add additional linked fields such as 
        <li>
            <p>sort: (not implemented - planned for June 2011)
            <p>comma separated list of col names e.g. rating,creator,-update_date (- denotes alternate sorting)
        <li>
            <p>limit: limit items returned default='20'
            <p>e.g. 10 - only return 10 items max
            <p>e.g.  0 - return all items with no maximum limit
        <li>
            <p>offset: define where in the list to return default='0'
            <p>e.g. 30 - start the listing at item 30
    </ul>
</div>
</section>


<section>
<h3 id="validation"><span>(1.0 WIP)</span>Validation</h3>
<div>
    <p>If an invalid request is made the following structure will be returned.
    <pre>
    {
        "status" : "invalid",
        "message": "description of invalid state", 
        "data"   : {
            "foo": "bar",
            "baz": "qux",
            ...
            "invalid": {
                "foo": "description of validation error"
            }
        }
    }
    </pre>
    <p>Invalid fields are listed in the 'invalid' dictionary with a text description of why the validation failed</p>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>Concept of 'me'</h3>
<div>
    <p>Anywhere a username or user_id are present in the API, you may submit the value 'me' to refer to the currently logged in user e.g.:
    <ul>
        <li>members/me/content
        <li>members?followed_by=me
        <li>contents?boomed_by=me
    </ul>
</div>
</section>

<!--
<section>
<h3><span>(1.0 WIP)</span>Global Settings</h3>
<div>
    <h4>Language</h4>
    <p>Languages can be set using standard 2 letter codes
    <p>Supported languages: en</p>
    <p>Language can be set (in order of precedence) by:
    <ol>
        <li>Sending the 'lang' parameter with any GET or POST request
        <li>Calling 'session set lang' (to be implemented)
        <li>Using the 'settings' controller to set the 'lang' property
    </ol>
</div>
</section>
-->

</article>
