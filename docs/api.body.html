<article>
<h2>Notes about this document:</h2>

<section>
<h3>Terminology</h3>
<div>
    <h4>Implementation Indicators</h4>
    <ul>
    <li>"WIP" = "Work in Progress; first attempt to get something that works at all"
    <li>"Draft" = "It seems to work, waiting for the whole team + consultants to say Yay"
    <li>"Untested" = "automated tests are incomplete"
    <li>Just a number = "Ready to be used -- team + consultants like the design and it is tested"
    </ul>
    <h4>Terminology Note</h4>
    <p>The API is abstracted from the presentation of the Civicboom website.
       There may be some discrepancies e.g. 'groups' in the API are referred to as 'Hubs' on the website.
       The API terminology is fixed. The website front-end terminology is subject to change.</p>
</div>
</section>

<section>
<h3>Development Server</h3>
<div>
    <p>Developers are encouraged to test the use of the API on a dedicated test server.
    <p><a href="http://test.civicboom.com">http://test.civicboom.com</a>
    <p>The data on the test server will be periodically reset.
    <p>The test server is not a guaranteed service and may have periods of unavailability.
</div>
</section>

</article>


<article>
<h2>Things common to all requests:</h2>

<section>
<h3><span>(1.0 WIP)</span>Transport</h3>
<div>
    <ul>
    <li>All content-modifying actions (POST, PUT, DELETE) require an _authentication_token
        argument; since this is universal, it isn't mentioned in the docs for each action
        separately. The token can be found by calling /account/signin.json or /account/signin.xml
    <li>Cookies are used to keep track of logged in sessions.
        Your client may be sent additional cookies while using the API.
        These should be stored and retrieved as normal cookies.
    <li>PUT and DELETE can be emulated with POST, having the form variable "_method" set
        to PUT or DELETE respectively
    <li>HTTP status codes are used:
        <ul>
          <li>200 - generic success
          <li>201 - content created
          <li>400 - generic user error (commonly missing required data when submitting a form)
          <li>403 - permission denied
          <li>404 - content/member not found
          <li>500 - generic server error
          <li>501 - not implemented
          <li>502 - back-end server is down for maintenance
        </ul>
    </ul>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>Object types overview</h3>
<div>
    <p>The Civicboom API has 3 core object types. An overview is provided here but
       the details of these types are given in detail with the call definitions.
    
    TODO:-auto list fields in model? default/full-
    
    <h4>Content</h4>
    
    article
    assignment
    
    <h4>Member</h4>
    user
    group
    
    <h4>Message</h4>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>Data formats</h3>
<div>
    <p>Formats can be added to the end of the URL; for instance while /contents/42
    will show you content #42 in a browser-friendly way (HTML), a standalone app
    may prefer /contents/42.json or /contents/42.xml
    
    <p>Most examples in this documentation will be given in JSON format.
    
    <p>Format list:
    <ul>
        <li>JSON
        <li>XML
        <li>Frag
        <li>RSS
        <li>Redirect
        <li>iCal
        <li>PDF
    </ul>
    
    <h4>JSON</h4>
	<p>Note that in all cases, JSON requests can have a "callback" parameter
	passed to them in order to wrap the data as JSONP. Valid callback names
	can have letters, numbers, and underscores in them.

    <p>JSON data format:
    <pre>
    {
        "status" : "ok" / "error" / "invalid",                 (required)
        "message": "string to show in app status bar / popup", (required; can be null if status=ok)
        "data"   : {                                           (required; blank dictionary if there is no data)
            "foo": "bar", # function-specific data
            "baz": "qux",
            ...
        }
    }
    </pre>
    
    <p>JSON list format:
    <pre>
    {
        "status" : "ok",
        "message": null,
        "data"   : {
            "list": {
                "items": [
                    {...},
                    {...},
                    {...}
                ],
                "type"  : "content" / "member" / "message",
                "limit" : 20,
                "offset":  0,
                "count" :  3
            }
        }
    }
    </pre>
    
    <h4>XML</h4>
    <p>The same as JSON, just in XML.</p>
    
    <h4>Frag</h4>
    <p>Fragments are chunks of HTML data with marked up with class's for use with
       injecting content directly into existing web pages. The developer can then
       style this injected HTML simply with standard CSS rules
    <p>WIP NOTE: Currently .frag returns HTML specific to the Civicboom site and is
       not generic enough for mainstream use. Work is currently underway to make the
       .frag a generic tool for developers. (tentatively May 2011)
    
    <h4>RSS</h4>
    <p>Objects and Lists can be returned as RSS feeds
    <p>Some of the fields are not relevant for an RSS output.
       The list is fields returned in the RSS often a subset of the JSON/XML output.
    <p>It is part of the RSS standard that clients can sort items by date.
       Some objects may return lists of items that are not in date order.
    <p>Hint: Common use of RSS 'content' lists:
       By default media attachments are not included in the RSS return
       but can be enabled by including the parameter 'include_fields=attachments'</p>
    
    <h4>Redirect</h4>
    <p>Actions can be called with the 'redirect' format. This will perform the action on Civicboom
       and then redirect back to http_referer.
    <p>If the request has come from an external site the user will be prompted to confirm they want to perform the action.
       If they are not currently logged in they will be prompted to signin/signup
    <p>(NOTE: When undertaking the signup process it may not be possible to return to external sites via http_referer,
       this will be investigated)
       
    <h4>iCal</h4>
    <p>Pending implementation</p>
    
    <h4>PDF</h4>
    <p>Pending implementation</p>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>List Controls</h3>
<div>
    <p>API calls masked as 'list' will return lists of objects.
       These lists can be customised by passing common control parameters.
    <ul>
        <li>
            <p>list_type: default='default'
            <p>Permitted Values
            <ul>
            <li>'empty' = no fields (to be used with include_fields to build a custom object)
            <li>'default' = object fields (usually used for list as no links to other objects are present)
            <li>'full' = object + links (links to sub objects or lists are followed e.g. a contents creator field will contain a sub object member).
                 full field lists often include fields that are expensive to process and are normally unnecessary for summary lists.
            </ul>
        
        <li>
            <p>'exclude_fields': omit fields from the return object default=''
            <p>e.g. "exclude_fields=avatar_url,location_home" will omit the fields avatar_url and location_home form the returned list.
        
        <li>
            <p>'include_fields': fields to include in the return object default=''
            <p>e.g. 'include_fields=followers,username,name,webpage,content_public'.
            <p>e.g. 'include_fields=attachments'
            <p>Often used in conjunction with 'list_type=empty' to build a custom return object.
               Often used to add additional linked fields such as 
        <li>
            <p>sort: (not implemented - planned for June 2011)
            <p>comma separated list of col names e.g. rating,creator,-update_date (- denotes alternate sorting)
        <li>
            <p>limit: limit items returned default='20'
            <p>e.g. 10 - only return 10 items max
            <p>e.g.  0 - return all items with no maximum limit
        <li>
            <p>offset: define where in the list to return default='0'
            <p>e.g. 30 - start the listing at item 30
    </ul>
</div>
</section>


<section>
<h3 id="validation"><span>(1.0 WIP)</span>Validation</h3>
<div>
    <p>If an invalid request is made the following structure will be returned.
    <pre>
    {
        "status" : "invalid",
        "message": "description of invalid state", 
        "data"   : {
            "foo": "bar",
            "baz": "qux",
            ...
            "invalid": {
                "foo": "description of validation error"
            }
        }
    }
    </pre>
    <p>Invalid fields are listed in the 'invalid' dictionary with a text description of why the validation failed</p>

</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>Concept of 'me'</h3>
<div>
    <p>Anywhere a username or user_id are present in the API, you may submit the value 'me' to refer to the currently logged in user e.g.:
    <ul>
        <li>members/me/content
        <li>members?followed_by=me
        <li>contents?boomed_by=me
    </ul>
</div>
</section>


<section>
<h3><span>(1.0 WIP)</span>Global Settings</h3>
<div>
    <h4>Language</h4>
    <p>Languages can be set using standard 2 letter codes
    <p>Supported languages: en</p>
    <p>Language can be set (in order of precedence) by:
    <ol>
        <li>Sending the 'lang' parameter with any GET or POST request
        <li>Calling 'session set lang' (to be implemented)
        <li>Using the 'settings' controller to set the 'lang' property
    </ol>
</div>
</section>


</article>
